2025-05-04 23:23:13,180 - app - ERROR - FATAL: Invalid ENCRYPTION_KEY configured. Application cannot start securely. Error: Invalid ENCRYPTION_KEY length or format. Must be 32 url-safe base64-encoded bytes.
2025-05-05 03:39:00,483 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-05-05 03:39:00,681 - app - ERROR - Unhandled exception during request to /api/v1/auth/register: (psycopg2.errors.ForeignKeyViolation) insert or update on table "users" violates foreign key constraint "users_role_id_fkey"
DETAIL:  Key (role_id)=(5) is not present in table "roles".

[SQL: INSERT INTO users (office_id, role_id, name, email, password_hash, join_code) VALUES (%(office_id)s, %(role_id)s, %(name)s, %(email)s, %(password_hash)s, %(join_code)s) RETURNING users.user_id, users.created_at, users.updated_at]
[parameters: {'office_id': None, 'role_id': 5, 'name': 'gAAAAABoGDLUJzxKLD_lcty7rrft169qYevSgDhz8qTetruynYWHNGcCtq_0CtogvD7RJiInqn6BcAa6MAdY0wGRtx7Bl5z1sw==', 'email': 'gAAAAABoGDLUIVpM5WG_pAHNsciWGeW8BUSA2oKj9sNLv3K19oHfMtfcLpPlY3KCBTI8d1kz2FIrmoyu65wXN-lVqjdhAfKNHQ==', 'password_hash': '$2b$12$Raji6Xs3UUFWB7EeOmH1R.4szp5dG2oLll97ra18C.N943E1IZN2C', 'join_code': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.ForeignKeyViolation: insert or update on table "users" violates foreign key constraint "users_role_id_fkey"
DETAIL:  Key (role_id)=(5) is not present in table "roles".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/api/core/middleware.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/starlette/concurrency.py", line 37, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2470, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/api/auth/router.py", line 70, in register_user
    created_user = crud_user.create_user(db=db, user=user_in)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/api/crud/crud_user.py", line 55, in create_user
    db.commit()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.errors.ForeignKeyViolation) insert or update on table "users" violates foreign key constraint "users_role_id_fkey"
DETAIL:  Key (role_id)=(5) is not present in table "roles".

[SQL: INSERT INTO users (office_id, role_id, name, email, password_hash, join_code) VALUES (%(office_id)s, %(role_id)s, %(name)s, %(email)s, %(password_hash)s, %(join_code)s) RETURNING users.user_id, users.created_at, users.updated_at]
[parameters: {'office_id': None, 'role_id': 5, 'name': 'gAAAAABoGDLUJzxKLD_lcty7rrft169qYevSgDhz8qTetruynYWHNGcCtq_0CtogvD7RJiInqn6BcAa6MAdY0wGRtx7Bl5z1sw==', 'email': 'gAAAAABoGDLUIVpM5WG_pAHNsciWGeW8BUSA2oKj9sNLv3K19oHfMtfcLpPlY3KCBTI8d1kz2FIrmoyu65wXN-lVqjdhAfKNHQ==', 'password_hash': '$2b$12$Raji6Xs3UUFWB7EeOmH1R.4szp5dG2oLll97ra18C.N943E1IZN2C', 'join_code': None}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-05-05 03:46:13,786 - app - WARNING - HTTPException during request to /api/v1/companies/: Status=401, Detail='Not authenticated'
2025-05-05 03:46:30,379 - app - WARNING - HTTPException during request to /api/v1/auth/login: Status=401, Detail='Incorrect email or password'
2025-05-05 03:46:42,982 - app - WARNING - HTTPException during request to /api/v1/auth/login: Status=401, Detail='Incorrect email or password'
2025-05-05 03:47:38,464 - app - WARNING - HTTPException during request to /api/v1/auth/login: Status=401, Detail='Incorrect email or password'
2025-05-08 04:22:35,348 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffaca72ee0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 04:22:35,351 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffaca72ee0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 04:22:35,829 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffaca72ee0 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-08 04:22:35,835 - app - ERROR - Unhandled exception during request to /api/v1/auth/register: (sqlite3.OperationalError) 505, message='Invalid response status', url='https://chiro-app-wrtirado.aws-us-west-2.turso.io/'
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 288, in _acquire_connection
    await conn.wait_connected()
  File "/usr/local/lib/python3.11/site-packages/libsql_client/hrana/conn.py", line 76, in wait_connected
    raise self.exception
  File "/usr/local/lib/python3.11/site-packages/libsql_client/hrana/conn.py", line 81, in _do_connect
    return await session.ws_connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/aiohttp/client.py", line 1021, in _ws_connect
    raise WSServerHandshakeError(
aiohttp.client_exceptions.WSServerHandshakeError: 505, message='Invalid response status', url='https://chiro-app-wrtirado.aws-us-west-2.turso.io/'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 3298, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/impl.py", line 447, in connect
    return _ConnectionFairy._checkout(self, self._fairy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 713, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/impl.py", line 429, in _do_get
    c = self._create_connection()
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 675, in __init__
    self.__connect()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 901, in __connect
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/__init__.py", line 93, in connect
    return handler(
           ^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 247, in __init__
    super().__init__(
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/types.py", line 362, in __init__
    self._raw_init()  # after this point we can call the DB
    ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 262, in _raw_init
    self._conn = self._acquire_connection(self._database)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 215, in wrapper
    return future.result(timeout=self._timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/_async_executor.py", line 204, in run_in_main_loop
    r = await r
        ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 294, in _acquire_connection
    raise exc
sqlite3.OperationalError: 505, message='Invalid response status', url='https://chiro-app-wrtirado.aws-us-west-2.turso.io/'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/local/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/usr/local/lib/python3.11/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/api/core/middleware.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 156, in call_next
    raise app_exc
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 214, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/starlette/concurrency.py", line 37, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 2470, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/api/auth/router.py", line 59, in register_user
    db_user = crud_user.get_user_by_email(db, email=user_in.email)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/api/crud/crud_user.py", line 13, in get_user_by_email
    return db.query(User).filter(User.email == email).first()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 3274, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 148, in __init__
    Connection._handle_dbapi_exception_noconnection(
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2439, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 146, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 3298, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/impl.py", line 447, in connect
    return _ConnectionFairy._checkout(self, self._fairy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 713, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/impl.py", line 429, in _do_get
    c = self._create_connection()
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 675, in __init__
    self.__connect()
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 901, in __connect
    with util.safe_reraise():
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/pool/base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/__init__.py", line 93, in connect
    return handler(
           ^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 247, in __init__
    super().__init__(
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/types.py", line 362, in __init__
    self._raw_init()  # after this point we can call the DB
    ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 262, in _raw_init
    self._conn = self._acquire_connection(self._database)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 215, in wrapper
    return future.result(timeout=self._timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 456, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/_async_executor.py", line 204, in run_in_main_loop
    r = await r
        ^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/libsql_client/dbapi2/hrana.py", line 294, in _acquire_connection
    raise exc
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) 505, message='Invalid response status', url='https://chiro-app-wrtirado.aws-us-west-2.turso.io/'
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-05-08 11:58:31,213 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff92f68b90 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 11:58:31,216 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff92f68b90 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 11:58:31,464 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff92f68b90 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-08 12:00:48,902 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8dad3340 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 12:00:48,903 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8dad3340 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 12:00:49,129 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8dad3340 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-08 12:30:19,863 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff92da3430 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 12:30:19,865 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff92da3430 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 12:30:20,060 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff92da3430 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-08 12:31:05,391 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8ff224e0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 12:31:05,392 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8ff224e0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 12:31:05,557 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8ff224e0 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-08 12:35:03,075 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffab8132a0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 12:35:03,076 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffab8132a0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 12:35:03,300 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffab8132a0 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-08 12:55:06,664 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9f363110 name='Thread-1 (_thread_main)' stopped>: created
2025-05-08 12:55:06,666 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9f363110 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-08 12:55:06,984 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9f363110 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-09 04:21:22,762 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa53331b0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-09 04:21:22,763 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa53331b0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-09 04:21:23,071 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa53331b0 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-09 04:23:38,440 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb28c3160 name='Thread-1 (_thread_main)' stopped>: created
2025-05-09 04:23:38,441 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb28c3160 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-09 04:23:38,652 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb28c3160 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-10 12:14:19,549 - app - ERROR - FATAL: Invalid ENCRYPTION_KEY configured. Application cannot start securely. Error: Invalid ENCRYPTION_KEY length or format. Must be 32 url-safe base64-encoded bytes.
2025-05-10 12:16:08,171 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb22b0b90 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:16:08,172 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb22b0b90 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:16:08,173 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb22b0b90 name='Thread-1 (_thread_main)' stopped>: thread did stop
2025-05-10 12:16:08,176 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473652517328>: database='ws://db:8080' destroyed
2025-05-10 12:16:08,176 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffb22b0b90 name='Thread-1 (_thread_main)' stopped>: destroyed
2025-05-10 12:17:18,200 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff930a3660 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:17:18,201 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff930a3660 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:17:18,208 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473207281360>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff9323c910>
2025-05-10 12:21:33,797 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9627eee0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:21:33,797 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9627eee0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:21:33,800 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473259329552>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff962a1410>
2025-05-10 12:22:21,023 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff949d30c0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:22:21,023 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff949d30c0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:22:21,026 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473158845584>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff9343d0d0>
2025-05-10 12:23:56,819 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9bd62da0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:23:56,820 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff9bd62da0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:23:56,822 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473312544784>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff99c32050>
2025-05-10 12:24:08,003 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa68bada0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:24:08,003 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa68bada0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:24:08,006 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473514104336>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffffa5559210>
2025-05-10 12:24:34,487 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa48668a0 name='Thread-2 (_thread_main)' stopped>: created
2025-05-10 12:24:34,488 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffffa48668a0 name='Thread-2 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:24:34,491 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473443348112>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffffa49a8510>
2025-05-10 12:24:34,497 - app - WARNING - HTTPException during request to /api/v1/auth/login: Status=401, Detail='Incorrect email or password'
2025-05-10 12:26:41,817 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8261d130 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:26:41,818 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff8261d130 name='Thread-1 (_thread_main)' started loop=<_UnixSelectorEventLoop running=True closed=False debug=False>>: thread ready
2025-05-10 12:26:41,821 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472856182352>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff819c1750>
2025-05-10 12:26:41,855 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472856182352>: database='ws://db:8080' destroyed
2025-05-10 12:31:24,125 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff7eef8910 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:31:24,125 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff7eef8910 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:31:24,129 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472849219088>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff7db6ce50>
2025-05-10 12:31:48,408 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff87138460 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:31:48,408 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff87138460 name='Thread-1 (_thread_main)' started loop=<_UnixSelectorEventLoop running=True closed=False debug=False>>: thread ready
2025-05-10 12:31:48,412 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472948319248>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff871ad110>
2025-05-10 12:31:48,454 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472948319248>: database='ws://db:8080' destroyed
2025-05-10 12:31:54,220 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff86659180 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:31:54,221 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff86659180 name='Thread-1 (_thread_main)' started loop=<_UnixSelectorEventLoop running=True closed=False debug=False>>: thread ready
2025-05-10 12:31:54,225 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472937070352>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff866e54d0>
2025-05-10 12:31:54,231 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-05-10 12:31:54,520 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472937070352>: database='ws://db:8080' destroyed
2025-05-10 12:32:08,196 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff7cfa19a0 name='Thread-2 (_thread_main)' stopped>: created
2025-05-10 12:32:08,197 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff7cfa19a0 name='Thread-2 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:32:08,199 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472767656336>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff7c54a010>
2025-05-10 12:32:08,205 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-05-10 12:35:54,997 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff7b36b1b0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:35:54,998 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff7b36b1b0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:35:55,001 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281472807576080>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff7ba2fa10>
2025-05-10 12:35:56,259 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff901272a0 name='Thread-1 (_thread_main)' stopped>: created
2025-05-10 12:35:56,260 - libsql_client.dbapi2._async_executor - INFO - <AsyncExecutor at 0xffff901272a0 name='Thread-1 (_thread_main)' started loop=<uvloop.Loop running=True closed=False debug=False>>: thread ready
2025-05-10 12:35:56,263 - libsql_client.dbapi2.types - INFO - ConnectionHrana<281473157326544>: database='ws://db:8080' created stream: <libsql_client.hrana.conn.HranaStream object at 0xffff9014cf90>
